# Deepdive
## 公司实体间股权交易二元关系抽取   

Linux ubuntu| python 3.7    

参考openKG上支持中文的deepdive中运用示例：斯坦福大学的开源知识抽取工具（三元组抽取） http://www.openkg.cn/tool/cn-deepdive 需要先下载Deepdive工具，可在网址中下载。       
已知具有交易关系的公司实体对见transaction_dbdata.csv         
原始数据集见articles.csv，示例如下：    
```
1201734370,证券代码:600969 证券简称:郴电国际 编号:公告临 2015-033     湖南郴电国际发展股份有限公司   为郴州市城市建设投资发展集团有限公司         提供担保公告     本公司董事会及全体董事保证本公告内容不存在任何虚假记载、 误导性陈述或者重大遗漏，并对其内容的真实性、准确性和完整性承 担个别及连带责任。如有董事对临时公告内容的真实性、准确性和完整性无法保证或 存在异议的，公司应当在公告中作特别提示。           重要内容提示: ●被担保人名称:郴州市城市建设投资发展集团有限公司(以下简称“郴州城投公司”)。 ●本次担保金额及累计为其提供的担保余额:本次对外担保金额为 4500 万元人民币，截止本公告日，本公司对郴州城投公司的担保 除本次担保外不存在其他任何担保。●本次担保是否有反担保:无。●对外担保逾期的累计数量:截至本公告日，本公司无逾期担保 事项。一、 担保情况概述经本公司第五届董事会第十四次会议审议通过，同意为郴州市城 市建设投资发展集团有限公司向国家开发银行湖南省分行申请国家 第二批专项建设基金借款 4500 万元人民币的贷款事项提供全额、全1程连带责任保证担保，本次担保的借款款项用于本公司 2015 年城镇 配电网建设改造工程项目。二、被担保人基本情况(一)被担保人是郴州市城市建设投资发展集团有限公司;注册 地点:郴州市北湖区五岭大道 1 号(市政府机关政务文化休闲中心 7 楼);法定代表人为刘建国;经营范围:城市基础设施建设项目投资、 融资及相关的配套服务;农、林、水项目投资、开发建设及相关的配 套服务;房地产开发经营;土地一级开发及整理。(国家禁止经营的 除外，涉及行政许可的凭证可证经营)。截止 2015 年 6 月 29 日郴州 城投公司的信用等级为双 A 级，截止 2014 年 12 月 31 日，资产总额 为 2，888，924.53 万元，资产净额为 1，618，965，52 万元，资产负债率为 43.61%，营业收入为 180，524.54 万元，利润总额为 61，656.39 万元。(二)详细说明被担保人与上市公司关联关系或其他关系。 本公司与郴州城投公司无关联关系。三、担保协议的主要内容 本次担保的方式是提供连带责任保证，担保范围:根据主合同的约定，借款人向债权人借款 4500 万元人民币，借款期限 15 年(即 2015 年 10 月 30 日至 2030 年 10 月 29 日止)。保证人愿意就借款人 偿付主合同项下全部借款本金、利息、罚息、复利、补偿金、违约金、 损害赔偿金和实现债权的费用向债权人提供担保。本合同的保证期间 为主合同下债务履行届满之日起两年。四、董事会意见为争取国家专项建设基金，支持项目建设，经国家发改委批准， 公司 2015 年城市电网改造项目列入了国家第二批专项建设基金支持 项目，由国家开发银行湖南分行发放建设基金借款 4500 万元，期限215 年，年利率 1.2%。按照国家对专项建设基金发放的有关规定，须 由郴电国际的股东向国家开发银行借款，专项用于 2015 年郴电国际 城镇配电网建设改造工程项目。郴州市政府旗下的郴州城投公司，是 国家开发银行湖南分行的信贷客户，在银行存在着良好的信用，符合 国家开发银行放贷条件。郴州城投公司同意为本公司承贷 4500 万元 借款，但须由本公司对此项借款提供全额、全程连带责任保证担保。 本次担保的借款款项是用于本公司 2015 年城镇配电网建设改造工程 项目。故本公司董事会同意本次担保事项。本公司的独立董事对本次担保事项发表了独立意见如下:我们认 为，本次担保的借款款项是用于本公司 2015 年城镇配电网建设改造 工程项目，此次担保事项符合公司章程及相关规定的要求。我们同意 公司为上述贷款项目进行担保。  五、累计对外担保数量及逾期担保的数量截至公告披露日上市公司及其控股子公司均无对外担保，本次对 外担保 4500 万元人民币占 2014 年 12 月 31 日本公司经审计归属于上 市公司股东净资产的 1.79%，截止目前，本公司无逾期担保。  六、上网公告附件  公司第五届董事会第十四次会议决议。  特此公告。湖南郴电国际发展股份有限公司董事会 2015 年 10 月 29 日3    
1201734454,证券代码:600108 证券简称:亚盛集团 公告编号:临2015-067   甘肃亚盛实业(集团)股份有限公司    第七届监事会第四次会议决议公告甘肃亚盛实业(集团)股份有限公司第七届监事会第四次会议于 2015 年 10 月 27 日上午 11:30 时在甘肃省兰州市城关区雁兴路 21 号公司 14 楼会议室召开，会议以现场方式进行，会议由监事会主席 李金有主持。会议应到监事 5 人，实到 5 人，监事崔伟女士因出差委 托监事王凤鸣先生代为出席本次会议，并发表同意意见。本次会议的 召开符合<公司法>、<证券法>、<公司章程>等的有关规定，会议合 法有效。经与会监事认真审议，采取记名投票表决，会议形成以下决议: 一、以 5 票同意，0 票反对，0 票弃权，审议通过了<公司 2015年第三季度报告>经审核，监事会认为:董事会编制和审核<公司 2015 年第三季 度报告>全文和正文的程序符合法律、行政法规和中国证监会的规定， 报告内容真实、准确、完整的反映了公司本报告期的财务状况和经营 成果，不存在任何虚假记载、误导性陈述和重大遗漏。二、会议以 5 票同意、0 票反对、0 票弃权，审议通过了<关于 转让工业用地土地使用权的关联交易的议案>     本公司监事会及全体监事保证本公告内容不存在任何虚假记载、 误导性陈述或者重大遗漏，并对其内容的真实性、准确性和完整性承 担个别及连带责任。 1公司监事会认为:本次关联交易公开、公平、合理，表决程序合 法有效，交易合同内容公允，未损害中小股东和非关联股东的权益， 符合全体股东的利益，符合有关法律、法规和公司章程的规定。三、会议以 5 票同意、0 票反对、0 票弃权，审议通过了<关于 全资子公司间股权转让的议案>特此公告。甘肃亚盛实业(集团)股份有限公司 监事会2015 年 10 月 29 日2    
1201734455,证券代码:600108 证券简称:亚盛集团 公告编号:2015-068    甘肃亚盛实业(集团)股份有限公司     关于黑河黄藏寺水利枢纽工程      征占用土地及补偿的公告     本公司董事会及全体董事保证本公告内容不存在任何虚假记载、 误导性陈述或者重大遗漏，并对其内容的真实性、准确性和完整性承 担个别及连带责任。         一、征占用土地及补偿的基本情况黄藏寺水利枢纽工程是<黑河流域近期治理规划>中安排的黑河 干流骨干调蓄工程，为国务院第十四次常务会议确定的“十三五”期 间建设的172项重大水利工程之一，并且为列入2015年底开工的44个 项目之一。亦是合理调配黑河中下游生态和经济社会用水，提高黑河 水资源利用效率，兼顾发电等综合利用而兴建的一项大型水利工程。 黄藏寺水利枢纽坝址位于黑河上游东、西两岔交汇处以下11公里的黑 河干流八宝河入口处，上游距青海省海北州祁连县县城19公里，下游 距莺落峡80公里，坝址左岸为甘肃省张掖市肃南县，右岸为青海省海 北州祁连县。涉及的工程占地和淹没区主要为张掖市肃南县境内的原 宝瓶河牧场(现甘肃亚盛实业(集团)股份有限公司宝瓶河分公司) 和张掖市寺大隆林场。甘肃亚盛实业(集团)股份有限公司宝瓶河分公司(以下简称: 宝瓶河分公司)位于张掖市肃南裕固族自治县中部的康乐乡境内，由1于黄河水利委员会黑河流域管理局(以下简称:黑河管理局)在本公 司宝瓶河分公司地域建设黑河黄藏寺水利枢纽工程，该工程项目征占 用宝瓶河分公司土地面积3，092.73亩(其中:水库淹没影响区及枢纽 工程区征占草原地2，749.37亩，对外交通道路征占用地250亩，新建 场部生产购地93.36亩)，本次征占用地补偿标准执行<甘肃省人民 政府关于印发<甘肃省征地补偿区片综合地价及甘肃省征地补偿统一 年产值标准的通知>>(甘政发【2012】151号)，根据<中华人民共 和国草原法>和<草原征占用审核审批管理办法>、<黑河黄藏寺水 利枢纽工程建设征地移民安置规划大纲>之相关规定，经双方友好协 商，达成补偿协议，协议征占用地补偿总金额为6，040.41万元。  二、补偿款项的用途及其对公司的影响本次征占用地补偿事项，涉及的土地性质属于草原，帐面价值较 小，对本公司的正常生产经营影响不大。根据<大中型水利水电工程 建设征地补偿和移民安置条例>第十六条之规定，本次征占用地补偿 款项本公司将设立专户，并用于本公司宝瓶河分公司库区生产恢复和 移民安置。  敬请广大投资者注意投资风险。  特此公告。甘肃亚盛实业(集团)股份有限公司董事会 2015年10 月29 日2   
1201734457,证券代码:600108 证券简称:亚盛集团 公告编号:2015-072    甘肃亚盛实业(集团)股份有限公司     关于全资子公司间股权转让的公告     本公司董事会及全体董事保证本公告内容不存在任何虚假记载、误 导性陈述或者重大遗漏，并对其内容的真实性、准确性和完整性承担个 别及连带责任。       一、交易概述为整合马铃薯资源，推动马铃薯产业规模化、集中化、规范化发展， 增强市场竞争力，提高经营效益。公司拟将全资子公司山丹县芋兴粉业 有限责任公司(以下简称:芋兴粉业)100%股权、全资子公司甘肃天润 薯业有限责任公司(以下简称:天润薯业)100%股权及甘肃天润薯业有 限责任公司的全资子公司甘肃大有农业科技有限公司(以下简称:大有 科技)100%股权同价转让给甘肃亚盛薯业有限责任公司(以下简称:亚 盛薯业)。转让完成后，本公司全资子公司芋兴粉业、天润薯业及其全资 子公司大有科技将变为公司的全资子公司亚盛薯业的全资子公司。上述事项经公司第七届董事会第四次会议审议通过。根据公司章程 的有关规定，本次股权转让事项无须提交股东大会审议。本次股权转让不 涉及关联交易，亦不构成<上市公司重大资产重组管理办法>规定的重 大资产重组。二、交易对方情况介绍11、公司名称:甘肃亚盛薯业有限责任公司 2、企业性质:有限责任公司 3、注册地址:兰州市城关区雁兴路 21 号 10 楼 1002 室 4、注册资本:人民币壹亿元5、法定代表人:杨璞6、成立时间:2015 年 10 月 26 日 7、经营范围:农业新技术研发、推广;马铃薯、菊芋、蔬菜、水果种植;化肥、地膜、农用机械及配件、农具、初级农产品、植物淀粉的 销售。8、股权结构:本公司持有甘肃亚盛薯业有限责任公司 100%股权。三、交易标的基本情况(一)公司名称:山丹县芋兴粉业有限责任公司 注册地址:山丹县清霍公路 8.5 公里处法定代表人:张兴保注册资本:4，000 万元 经营范围:马铃薯、菊芋种植，收购，加工，销售;马铃薯、菊芋全粉、淀粉的收购，加工，销售。 股权结构:本公司持有山丹县芋兴粉业有限责任公司 100%股权。 截至 2014 年 12 月 31 日，该公司资产总计 7，181.12 万元，负债总额 5，145.96 万元，净资产 2，035.16 万元;2014 年实现营业收入 2，840.61 万元，净利润-754.71 万元。2(二)公司名称:甘肃天润薯业有限责任公司 法定代表人:张希林注册资本:3，000 万元注册地址:甘肃省张掖市山丹县山马路 7 号 经营范围:马铃薯脱毒基础种薯生产、经营(凭有效许可证生产、经营);其他农作物(不含种子)种植、储藏、检测、包装和销售;其他 农产品(不含粮食)收购、加工、批发零售;化肥、地膜的销售;与种 植业生产及农产品加工相关的技术开发与咨询服务。股权结构:本公司持有甘肃天润薯业有限责任公司 100%股权。截至 2014 年 12 月 31 日，该公司资产总计 5，230.68 万元，负债 总额 2，945.06 万元，净资产 2，285.62 万元;2014 年实现营业收入 2，153.85 万元，净利润-253.35 万元。(三)公司名称:甘肃大有农业科技有限公司 法定代表人:郭守斌注册资本:3，640 万元 注册地址:甘肃省兰州市榆中县三角城乡三角城村。 经营范围:马铃薯基础种薯、蔬菜、水果的农业新技术研究及推广应用;马铃薯、蔬菜、水果种植、购销;其他农作物的种植、购销。 股权结构:本公司全资子公司甘肃天润薯业有限责任公司持有甘肃大有农业科技有限公司 100%股权。截至 2014 年 12 月 31 日，该公司资产总计 4，567.76 万元，负债总额 2，170.22 万元，净资产 2，397.54 万元;2014 年实现营业收入32，066.18 万元，净利润-715.01 万元。  四、本次股权转让对公司的影响马铃薯产业是公司重点发展产业之一，经过几年的培育和发展，公 司在马铃薯种薯繁育和商品薯种植、加工产品销售方面具备了一定的基 础和规模，但经营主体分散，没有形成规模优势合力发展。为整合马铃 薯资源，通过内部重组整合，推动马铃薯产业规模化、集中化、规范化 发展，增强市场竞争力，提高经营效益。转让完成后，本公司全资子公司芋兴粉业、天润薯业及其全资子公 司大有科技将变为公司的全资子公司亚盛薯业的全资子公司，公司合并 报表范围未发生变化。本次股权转让对公司的正常经营、未来财务状况 和经营成果不会产生重大影响，亦不会损害公司及股东利益。五、备查文件目录1、第七届董事会第四次会议决议 2、股权转让协议(芋兴粉业公司) 3、股权转让协议(天润薯业公司) 4、股权转让协议(大有科技公司)特此公告。甘肃亚盛实业(集团)股份有限公司董事会 2015 年 10 月 29 日4    
```
调用nlp_markup.sh脚本实现NLP处理，这里主要是调用stanfordnlp集成好的jar包。          
调用后将数据存入sentences表中，示例如下：   

```
index doc_id	sentence_index	sentence_text	tokens	lemmas	pos_tags	ner_tags	doc_offsets	dep_types	dep_tokens    
0	24	1	泛海控股股份有限公司以272，961.98万元的价格收购控股股东中国泛海控股集团有限公司所持...	{泛海,控股,股份,有限,公司,以,272,，,961.98万,元,的,价格,收购,控股,股...	{泛海,控股,股份,有限,公司,以,272,，,961.98万,元,的,价格,收购,控股,股...	{NR,NN,NN,JJ,NN,P,CD,PU,CD,M,DEC,NN,NN,VV,NN,N...	{ORG,ORG,ORG,ORG,ORG,O,O,O,MISC,MISC,O,O,O,O,O...	{0,2,4,6,8,10,11,14,15,22,23,24,26,28,30,32,34...	{nn,nn,nn,amod,nsubj,case,dep,"",nummod,relcl,...	{3,3,5,5,14,13,10,0,10,13,10,13,14,0,21,19,19,...   
```

可以看到脚本实现了多个字段的NLP处理，包括分词、规则化处理、词性、命名实体识别（stanfordnlp分为七类）、offsets、依存类型、依存分词。    
接下来通过sentences表中的tokens和ner_tags,调用map_company_mention.py抽取NER为机构（ORG）的标签，生成表company_mention,即候选实体表。    
示例如下：   
```
mention_id mention_text doc_id sentence_index begin_index end_index   
1201841277_4_3_3 前本公司 1201841277 4 3 3    
```

Join实体表，从实体表中筛选出同句中的不同实体，生成候选实体对表，示例：   
```
p1_id p1_name p2_id p2_name   
186_0_12_12 新研究所 186_0_2_2 银基烯碳新材料集团股份有限公司    
```
接下来我们需要抽取候选实体对的文本特征，通过调用extract_transaction_features.py，输入sentence的NLP结果，输出NLP组合的各种POS/NER/词序列的特征，也可以自定义特征，得到transaction_feature表，示例：   
```
p1_id p2_id feature
1201746717_11_987_988 1201746717_11_1166_1167 NGRAM_2_[公司 50]   
1201746717_11_987_988 1201746717_11_1166_1167 NGRAM_3_[公司 50 徐洪林]   
1201746717_11_987_988 1201746717_11_1166_1167 NGRAM_1_[50]    
```
我们采用半监督方法训练（distance supervision)，所以需要在候选实体对中标出部分正负例，这里采用两种方式：        
1.使用supervise_transaction.py中的规则为特征打正负标签；    
2.使用已知具有交易关系的公司实体对transaction_dbdata.csv中数据和候选实体对关联；      
定义transaction_label表，初始标签均为0，对方式2的，直接给权重+3。      
然后对方式1和2标记后的结果中每对实体做vote，生成最后标签，得表transaction_label_resolved.      
构建因子图，可以规则如下：1.有我要求的特征，如'股权','投资'，或者指定了权重，如weight是3.0。2.利用transaction_label_resolved，若>0，then TRUE.   
因子图由两部分组成，    
1.transactin_feature,即用于规则1   
2.has_transaction，用于规则2   
```
p1_id p2_id label   
1263_0_9_9 1263_0_7_7 NULL   
3316_0_5_6 3316_0_10_11 -1    
```
接下来计算P(vi)的值，如示例的第一行，不妨设为V1，第二行V2，我们用边缘概率，计算V1在取1时的概率，考虑先验变量，得置信值。    

最后得到的结果为：

![image](https://github.com/TomatoTang/Deepdive_/blob/master/image/image1.png)

若采用deepdive提供的可视化工具Mindtagger，http://deepdive.stanford.edu/labeling 启动web服务可实现可视化：

![image](https://github.com/TomatoTang/Deepdive_/blob/master/image/image2.png)




